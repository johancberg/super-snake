<html>
	<head>
		<title>Johan C Berg | Super Snake</title>
		<link href="./style.css" type="text/css" rel="stylesheet">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
	<body>
		<div id="main-screen" class="main-page">
			<div class="main-content">
				<h1>Super Snake</h1>
				<div class="main-menus">
					<div id="menu-one">1 player</div>
					<div id="menu-two">2 players</div>
					<div id="menu-rules">How to play</div>
				</div>

			</div>

			<div class="rules-blocker"></div>
			<div id="rules-window" class="rules">
				<h2>Super Rules</h2>
				These are the rules of the game.
			</div>
		</div>

		<div id="game-screen" class="game-page hide">
			<div class="game-content">
				<div class="game-info">
					<div class="game-board">
						<div id="pl-one" class="snake"></div>
						<div id="pl-two" class="snake hide"></div>
					</div>
					<p id="pl-one" class="dir">Left: A | Right: D</p>
					<p id="pl-one" class="player">Player 1</p>
					<p id="pl-one" class="level">Level 1</p>

					<p id="pl-two" class="dir hide">Left: <- | Right: -></p>
					<p id="pl-two" class="player hide">Player 2</p>
					<p id="pl-two" class="level hide">Level 1</p>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			$("#menu-one").click(function() {
				$("#main-screen").addClass('hide')
				$("#game-screen").removeClass('hide')
				gameStart()
			})
			
			$("#menu-two").click(function() {
				$("#main-screen").addClass('hide')
				$("#game-screen").removeClass('hide')
				$(".game-info #pl-two").removeClass('hide')
				$("div#pl-one.snake").removeClass('hide')
				gameStart()
			})

			$("#menu-rules").click(function() {
				$(".rules").addClass('open')
					$(".rules-blocker").addClass('open')
			})
			$(".rules-blocker").click(function() {
				if($(".rules").css("display") === "block"){
					$(".rules").removeClass('open')
					$(".rules-blocker").removeClass('open')
				}
			})

			let gameRunning = true;

			async function gameStart() {
				let i = 0;
				while (gameRunning) {
					await moveSnake()
					await delay(100)
				}
			}

			const delay = (ms) => {
				return new Promise(resolve => setTimeout(resolve, ms))
			}

			const moveSnake = () => {
					let left = $("div#pl-one.snake").position().left
					$("div#pl-one.snake").css('left', left+5+'px')
					checkBorders()
			}

			const checkBorders = () => {
				const snake_one = $("div#pl-one.snake").position()
				const snake_two = $("div#pl-two.snake").position()
				if (snake_one.left <= 0 || snake_one.left >= 1200) {
					gameRunning = false
					console.log("Player one lost!")
				}
			}
		</script>
	</body>
</html>